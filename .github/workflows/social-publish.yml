# .github/workflows/social-publish.yml
name: Notify n8n to Publish

on:
  push:
    paths:
      - 'social/**.json'  # social í´ë”ì— json íŒŒì¼ì´ ì˜¬ë¼ì˜¬ ë•Œë§Œ ë°œë™!
    branches:
      - main

jobs:
  notify-n8n:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get changed file
        id: file
        run: |
          # ê°€ì¥ ìµœê·¼ì— ìˆ˜ì •ëœ json íŒŒì¼ì„ ì°¾ìŠµë‹ˆë‹¤.
          FILE=$(ls -t social/*.json | head -n 1)
          echo "Recent file: $FILE"
          echo "filepath=$FILE" >> $GITHUB_OUTPUT

      - name: Read JSON content
        id: json
        run: |
          # JSON íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ì„œ í™˜ê²½ë³€ìˆ˜ì— ë‹´ìŠµë‹ˆë‹¤.
          CONTENT=$(cat ${{ steps.file.outputs.filepath }} | jq -c .)
          echo "content=$CONTENT" >> $GITHUB_OUTPUT

      - name: Send to n8n
        uses: distributhor/workflow-webhook@v3
        with:
          # ğŸ‘‡ ì—¬ê¸°ì— ì•„ê¹Œ ngrok ì£¼ì†Œ + /webhook-test/publish-post ë¥¼ ë„£ì–´ì•¼ í•©ë‹ˆë‹¤.
          webhook_url: ${{ secrets.N8N_PUBLISH_URL }}
          data: ${{ steps.json.outputs.content }}